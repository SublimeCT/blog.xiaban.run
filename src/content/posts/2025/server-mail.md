---
title: æœåŠ¡å™¨è¯·æ±‚é˜¿é‡Œé‚®ç®±æœåŠ¡å™¨å‘é€é‚®ä»¶
published: 2025-02-13
description: 'æœ‰æ—¶åœ¨æœåŠ¡å™¨ä¸Šè§¦å‘æŸäº›äº‹ä»¶æ—¶, éœ€è¦å‘ç”¨æˆ·å‘é€é‚®ä»¶, ä½¿ç”¨ msmtp å®ç°å‘é€é‚®ä»¶, å¦‚æœå·²ç»å¼€é€šäº†é˜¿é‡Œé‚®ç®±, å°±æ— éœ€è‡ªå·±æ­å»ºé‚®ä»¶æœåŠ¡å™¨'
image: './assets/images/postfix.jpg'
tags: [
  'msmtp',
  'dns è§£æ',
  'é‚®ä»¶',
  'å‘é€é‚®ä»¶'
]
category: 'æ•™ç¨‹'
draft: false 
lang: 'zh-CN'
---

æœ‰æ—¶åœ¨æœåŠ¡å™¨ä¸Šè§¦å‘æŸäº›äº‹ä»¶æ—¶, éœ€è¦å‘ç”¨æˆ·(ä¸»è¦æ˜¯æˆ‘è‡ªå·±)å‘é€é‚®ä»¶, ä½¿ç”¨ `msmtp` å®ç°å‘é€é‚®ä»¶, å¦‚æœå·²ç»å¼€é€šäº†é˜¿é‡Œé‚®ç®±, å°± **æ— éœ€è‡ªå·±æ­å»ºé‚®ä»¶æœåŠ¡å™¨**

:::tip
ä¹‹å‰æˆ‘å·²ç»é…ç½®å¥½äº† [é˜¿é‡Œé‚®ç®± - å…è´¹ç‰ˆ](https://help.aliyun.com/document_detail/437165.html)(å‚è€ƒ [ğŸ“š é˜¿é‡Œäº‘é…ç½®åŸŸåé‚®ç®±](/posts/2025/configure-domain-name-mailbox/)), ä½†æ˜¯é˜¿é‡Œé‚®ç®±çš„ **[API å¼€æ”¾å¹³å°](https://help.aliyun.com/document_detail/2852847.html) å…è´¹ç‰ˆå¹¶ä¸æ”¯æŒ**, æ‰€ä»¥æ— æ³•é€šè¿‡ `API` å®ç°å‘é€é‚®ä»¶çš„åŠŸèƒ½, ä½†å¥½åœ¨ é˜¿é‡Œé‚®ç®± **å…è®¸ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯æ”¶å‘é‚®ä»¶**, æ‰€ä»¥åªè¦ **é…ç½®å¥½é˜¿é‡Œé‚®ç®±, å¹¶é€šè¿‡ [msmtp](https://wiki.archlinux.org/title/Msmtp) å‘é€é‚®ä»¶å³å¯**
:::

<!-- ## åŸŸåè§£æ
1. ~~`@ MX mail.example.com | 1`~~

è¿™æ¡ `MX` è®°å½•æ˜¯è¡¨ç¤º **æŒ‡å®šæ¥æ”¶é‚®ä»¶çš„æœåŠ¡å™¨**

:::tip
ç”±äºæˆ‘ **æ²¡æœ‰æ¥æ”¶é‚®ä»¶çš„éœ€æ±‚**(å·²ç»æœ‰ é˜¿é‡Œé‚®ç®± äº†), æ‰€ä»¥å¿½ç•¥ `@ MX mail.example.com | 1` è§£æ(ä¸é˜¿é‡Œé‚®ç®±çš„è§£æå†²çª)
:::

2. `@ A mail.example.com`

è¿™æ¡è®°å½•ç”¨æ¥è§£æ `mail` å­åŸŸååˆ°è‡ªå·±çš„æœåŠ¡å™¨

3. `@ TXT v=spf1 mx:mail.example.com -all`

è¿™æ¡è®°å½•ç”¨æ¥ **æŒ‡å®šå‘é€é‚®ä»¶çš„æœåŠ¡å™¨**

:::warning
å¦‚æœä½ åƒæˆ‘ä¸€æ ·åœ¨ `1` ä¸­æ²¡æœ‰é…ç½® `MX` è®°å½•, åˆ™æ­¤å¤„çš„ `mx:mail.example.com` åº”è¯¥æ›¿æ¢ä¸º `a:mail.example.com`(å³ `2` ä¸­é…ç½®çš„ `A` è®°å½•)
:::

`SPF(Sender Policy Framework)`æ˜¯ä¸€ç§ `DNS TXT` è®°å½•ï¼Œå®ƒç”¨äºæŒ‡å®šå“ªäº›æœåŠ¡å™¨æœ‰æƒä»£è¡¨ä½ çš„åŸŸåå‘é€é‚®ä»¶, ä»¥å‡å°‘åƒåœ¾é‚®ä»¶å’Œé‚®ä»¶æ¬ºè¯ˆçš„é£é™©, æ ¼å¼ä¸º:

```
v=spf1 [mechanisms] [modifiers]
```

- `v=spf1`: SPF ç‰ˆæœ¬
- `mechanisms`: è¡¨ç¤ºå…è®¸çš„é‚®ä»¶æœåŠ¡å™¨æ¥æº, æ¯”å¦‚ `ip4` / `mx` / `include` ç­‰
- `modifiers`: `-all` æ‹’ç»ä¸åŒ¹é…é‚®ä»¶ / `~all` è½¯å¤±è´¥ / `+all` å…è®¸æ‰€æœ‰

:::warning
å¦‚æœé…ç½®äº†é˜¿é‡Œé‚®ç®±:

æ³¨æ„: é˜¿é‡Œé‚®ç®±å·²ç»æœ‰ä¸€æ¡ `SPF` è®°å½•äº†(`@ TXT v=spf1 include:spf.qiye.aliyun.com -all`), è¿™é‡Œåªéœ€è¦å°†åŠ å…¥ `mail.example.com`:

```
@ TXT v=spf1 include:spf.qiye.aliyun.com a:mail.example.com -all
```
:::

### æˆ‘çš„æœ€ç»ˆé…ç½®

1. `@ A mail.example.com`
2. `@ TXT v=spf1 include:spf.qiye.aliyun.com a:mail.example.com -all` -->

## msmtp
é…ç½®å¥½è§£æè§„åˆ™å, å°±éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¹¶é…ç½® [msmtp](https://wiki.archlinux.org/title/Msmtp)

`msmtp` æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ `msmtp` å®¢æˆ·ç«¯(å‘½ä»¤è¡Œå·¥å…·), é€‚ç”¨äº **åªéœ€è¦å‘é€é‚®ä»¶çš„åœºæ™¯**

### å®‰è£… msmtp

```bash
sudo apt update && sudo apt install msmtp msmtp-mta -y
# å®‰è£…æ—¶ä¼šæç¤ºæ˜¯å¦å¯ç”¨ AppArmor, ç›´æ¥é€‰æ‹© No
```

### é…ç½® msmtp
```bash
vim /etc/msmtprc
```

```ini
# è®¾ç½®é»˜è®¤è´¦æˆ·
account default
# å¯ç”¨ STARTTLS
tls on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
# 465 ç«¯å£ä½¿ç”¨çš„æ˜¯ SSL/TLS, è€Œä¸æ˜¯ STARTTLS
tls_starttls off
# ä½ çš„ SMTP æœåŠ¡å™¨
host smtp.qiye.aliyun.com
# ç«¯å£å·ï¼ˆ465 æ˜¯ SMTPSï¼Œ587 æ˜¯ STARTTLSï¼‰
port 465
# ä½ çš„é‚®ä»¶è´¦æˆ·
auth on
user no-reply@example.com
password your-password
# å‘é€è€…é‚®ç®±
from no-reply@example.com
```

è¿™é‡Œéœ€è¦æ³¨æ„:
- é˜¿é‡Œé‚®ç®±åªå¼€æ”¾ `465` ç«¯å£, æ‰€ä»¥éœ€è¦å°† `tls_starttls` è®¾ç½®ä¸º `off`
- å°† `example.com` æ›¿æ¢ä¸ºä½ çš„åŸŸå

è¿™é‡Œåˆ›å»ºäº† `msmtp` çš„é…ç½®æ–‡ä»¶, é…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¾åˆ° `~/.msmtprc`, é…ç½®å¥½åæœ€å¥½è®¾ç½®ä¸€ä¸‹æƒé™ä¸º `600`

## é…ç½®é˜¿é‡Œé‚®ç®±
æˆ‘ä»¬ **ä¸åœ¨æœåŠ¡å™¨è‡ªå·±æ­å»ºé‚®ä»¶æœåŠ¡, ç›´æ¥é€šè¿‡é˜¿é‡Œé‚®ç®±å®ç°å‘é€é‚®ä»¶**, æ‰€ä»¥æ­¤åœºæ™¯ä¸‹, æœåŠ¡å™¨éœ€è¦å®‰è£…ç”¨æˆ·å‘é€é‚®ä»¶çš„å®¢æˆ·ç«¯(`msmtp`), é˜¿é‡Œé‚®ç®±éœ€è¦åˆ›å»ºè´¦å·å¹¶å¼€å¯ `SMTP`

### åˆ›å»º no-reply è´¦å·
åˆ›å»ºä¸€ä¸ªç”¨äºå‘é€é‚®ä»¶çš„è´¦å·

1. è¿›å…¥ [é˜¿é‡Œé‚®ç®±ç½‘é¡µç«¯](https://qiye.aliyun.com)
2. è¿›å…¥ ç»„ç»‡ä¸ç”¨æˆ· - å‘˜å·¥è´¦å·ç®¡ç† - æ–°å»ºè´¦å·(`no-reply@example.com`), **å¿…é¡»å‹¾é€‰ å¼€å¯ IMAP/SMPT æœåŠ¡**

### é…ç½®å®‰å…¨ç­–ç•¥
é˜¿é‡Œé‚®ç®±é»˜è®¤ä¸å…è®¸ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç™»å½•, éœ€è¦åœ¨ **å®‰å…¨ç®¡ç† - è´¦å·å®‰å…¨ç­–ç•¥** ä¸­è¿›è¡Œé…ç½®

1. è¿›å…¥ å®‰å…¨ç®¡ç† - è´¦å·å®‰å…¨ç­–ç•¥
2. (å¯é€‰) **è‡ªç”±ç«¯åŒé‡è®¤è¯ > å¯ç”¨èŒƒå›´ ä¸­æ’é™¤ `no-reply@example.com`**, æ­¤æ—¶å¯ä»¥é€šè¿‡é‚®ä»¶å®¢æˆ·ç«¯ç™»å½• `no-reply@example`
3. **ä¸‰æ–¹å®¢æˆ·ç«¯å®‰å…¨**, å¼€å¯ **å…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯**, å¯ç”¨èŒƒå›´æ ¹æ®éœ€è¦ä¿®æ”¹, å¿…é¡»åŒ…å« `no-reply@example.com`
4. **å®šæœŸä¿®æ”¹å¯†ç æé†’ > ä¾‹å¤–è´¦å·**, æ·»åŠ  `no-reply@example.com`

## å‘é€é‚®ä»¶
ç”±äºæ˜¯åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨ `msmtp` å‘é€é‚®ä»¶, æ‰€ä»¥éœ€è¦æ³¨æ„ä¸€ä¸‹é‚®ä»¶å†…å®¹çš„æ ¼å¼:

```
Subject: é‚®ä»¶æ ‡é¢˜
From: é‚®ä»¶å‘é€è€… <no-reply@example.com>
To: é‚®ä»¶æ¥æ”¶è€… <no-reply@example.com>

é‚®ä»¶å†…å®¹
```

```bash
echo -e "Subject: è¿™æ˜¯ä¸€å°æµ‹è¯•å‘é€çš„é‚®ä»¶, æ¥è‡ªæœåŠ¡å™¨\n\nè¿™é‡Œæ˜¯é‚®ä»¶å†…å®¹, ä»…ç”¨äºæµ‹è¯•" | msmtp me@test.com
```

![](./assets/images/server-mail-receiver.png)

:::warning
å¦‚æœå†…å®¹è¿‡äºç®€å•, å¯èƒ½ä¼šç›´æ¥è¿›å…¥é‚®ä»¶æ¥å—è€…çš„åƒåœ¾ç®±
:::

## å‚è€ƒ
- [msmtp](https://wiki.archlinux.org/title/Msmtp)
- [Ubuntu Linux æ­å»ºé‚®ä»¶æœåŠ¡å™¨ï¼ˆpostfix + dovecotï¼‰](https://www.cnblogs.com/007sx/p/18347813)
- [é˜¿é‡Œé‚®ç®±ç½‘é¡µç«¯](https://qiye.aliyun.com)
- [é˜¿é‡Œé‚®ç®± - å®¢æˆ·ç«¯é…ç½®](https://help.aliyun.com/document_detail/36576.html?spm=5176.21213303.J_v8LsmxMG6alneH-O7TCPa.7.7e842f3dt7Ez4P&scm=20140722.S_help@@%E6%96%87%E6%A1%A3@@36576._.ID_help@@%E6%96%87%E6%A1%A3@@36576-RL_465%E7%AB%AF%E5%8F%A3-LOC_llm-OR_ser-PAR1_2150440e17395222609746582e4052-V_4-RE_new5-P0_1-P1_0#:~:text=25-,465,-%E6%B3%A8%EF%BC%9A%E4%BB%A5%E4%B8%8B%E8%80%81)
